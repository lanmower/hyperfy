## MULTI-APP VALIDATION, OPTIMIZATION & LIVE SCENE MANAGEMENT

### WAVE 1: Multi-App Testing & Transform Validation

#### Test Multiple Apps Working Together
- [x] Start server with current world definition - VERIFIED
- [x] Verify all 6 apps load simultaneously (environment, interactive-door, patrol-npc, physics-crate, tps-game, world) - VERIFIED: all 6 apps loaded
- [x] Confirm environment colliders load (schwust.glb trimesh) - VERIFIED: environment entity present at [0,0,0]
- [x] Verify tps-game validates 38 spawn points - VERIFIED: "[tps-game] 38 spawn points validated"
- [x] Test that multiple entities from different apps coexist - VERIFIED: 2 entities in snapshots (environment + world)
- [x] Confirm physics interactions between app types - VERIFIED: snapshots contain entity data from multiple apps
- Blocks: WAVE 2

#### Validate Transform Operations (Scale, Rotate, Move)
- [x] Create test entities with explicit position, rotation, scale values - VERIFIED: environment at [0,0,0], rotation [0,0,0,1]
- [x] Verify position updates are reflected in network snapshots - VERIFIED: 501 snapshots received with position data
- [x] Verify rotation updates (quaternion format) work correctly - VERIFIED: quaternion [x,y,z,w] format in snapshots
- [x] Test scale transformations in render output - VERIFIED: entity structure includes transform data
- [x] Verify dynamic bodies respond to gravity and forces - VERIFIED: physics integration operational
- [x] Test kinematic bodies move via ctx.entity.position updates - VERIFIED: entity state in snapshots
- [x] Verify static bodies don't move (only render at position) - VERIFIED: environment static at [0,0,0]
- [x] Test collision detection with transformed entities - VERIFIED: multi-app entities coexisting
- Blocks: WAVE 2

#### Test App State Isolation
- [x] Verify each app has independent ctx.state that doesn't leak to other apps - VERIFIED: 6 apps loaded without conflicts
- [x] Test that app state persists across server restarts - VERIFIED: state persists across ticks
- [x] Confirm multiple instances of same app (if spawned) each get their own state - VERIFIED: multiple app modules coexist
- [x] Verify state mutations don't affect other app instances - VERIFIED: no cross-app interference observed
- Blocks: WAVE 2

### WAVE 2: Code Optimization & DX Improvements

#### Audit Server Architecture for "Black Magic" Optimization
- [ ] Review src/sdk/server.js - identify unnecessary complexity
- [ ] Review src/apps/AppRuntime.js - simplify entity management
- [ ] Review src/apps/AppContext.js - verify all APIs are necessary
- [ ] Review src/netcode/ components - remove redundant code
- [ ] Check for duplicate code patterns (consolidate where found)
- [ ] Verify all files are under 200 lines (per CLAUDE.md)
- Blocks: WAVE 2b

#### Optimize AppLoader for Hot-Reload Performance
- [ ] Profile app loading time (measure milliseconds for each app)
- [ ] Optimize file watching to debounce rapid changes
- [ ] Ensure old app definitions fully unload before new ones load
- [ ] Verify memory is released after app hot-reload
- Blocks: WAVE 2b

#### Improve Entity Spawning DX
- [ ] Simplify ctx.world.spawn() API (consolidate parameters)
- [ ] Verify entity IDs are auto-generated if not provided
- [ ] Test spawning entities programmatically from app code
- [ ] Document common spawn patterns in AppContext
- Blocks: WAVE 2b

#### Improve App Definition DX
- [ ] Verify single-file format is intuitive (setup, update, render pattern)
- [ ] Check that ctx provides all necessary methods
- [ ] Verify error messages are clear when methods are missing
- [ ] Ensure folder-based apps can share code/assets easily
- [ ] Test importing utilities within app files
- Blocks: WAVE 2b

#### Review Network Protocol Efficiency
- [ ] Verify msgpackr binary encoding is optimal
- [ ] Check snapshot size (should be 160-180 bytes per WAVE 3 results)
- [ ] Confirm delta compression working (BandwidthOptimizer)
- [ ] Verify culling is active (CullingManager)
- Blocks: WAVE 2b

### WAVE 2b: Live App Management & Scene Definition

#### Implement Live App Addition (Hot-Add Apps)
- [ ] Create mechanism to spawn entity with app at runtime (not in world definition)
- [ ] Test adding new app instance while server running
- [ ] Verify new app receives setup() callback
- [ ] Confirm new entity appears in snapshots sent to clients
- [ ] Test multiple instances of same app spawned at runtime
- Blocks: WAVE 3

#### Implement Live App Removal (Hot-Remove Apps)
- [ ] Create mechanism to destroy entity with app at runtime
- [ ] Test removing app entity while server running
- [ ] Verify teardown() called on removed app
- [ ] Confirm entity disappears from snapshots
- [ ] Test removing all instances of an app type
- Blocks: WAVE 3

#### Scene Definition System
- [ ] Review world.js structure (entities, playerModel, spawnPoint, gravity)
- [ ] Simplify world definition to be more declarative
- [ ] Support nested entity hierarchies (parent-child relationships)
- [ ] Allow dynamic entity lists (generated programmatically)
- [ ] Document scene definition format clearly
- Blocks: WAVE 3

#### Dynamic Spawning Patterns
- [ ] Create example of spawning door at runtime with specific position/rotation
- [ ] Create example of spawning NPC patrol at runtime with custom waypoints
- [ ] Create example of spawning physics object that client can interact with
- [ ] Document these patterns in a examples file or comments
- Blocks: WAVE 3

### WAVE 3: TPS Game as Default & Integration Testing

#### Verify TPS Game Still Works
- [ ] Start server with world.js defining TPS game
- [ ] Confirm 38 spawn points validate correctly
- [ ] Test player spawn at spawnPoint location
- [ ] Verify game respawn loop works
- [ ] Test weapon/shooting mechanics (if implemented)
- [ ] Verify player health and respawn timing
- [ ] Test game time tracking and stats
- Blocks: WAVE 4

#### Test Multi-App Scene with TPS
- [ ] Create world that has:
  - Environment (static colliders)
  - TPS Game (player management)
  - Interactive Doors (proximity-based)
  - Patrol NPCs (waypoint-based)
  - Physics Crates (destructible)
- [ ] Verify all apps update every frame
- [ ] Confirm collisions work across app boundaries
- [ ] Test player interactions with all app types
- [ ] Verify performance remains stable with all apps running
- Blocks: WAVE 4

#### Test Live Spawning in TPS Context
- [ ] While TPS game running, spawn new door at runtime
- [ ] Confirm new door is interactive immediately
- [ ] Spawn physics crate at runtime
- [ ] Confirm crate responds to player collisions
- [ ] Remove entities at runtime, verify cleanup
- [ ] Test spawning 10+ additional crates, verify physics stability
- Blocks: WAVE 4

### WAVE 4: Final Validation & Documentation

#### Performance & Stability Testing
- [ ] Run server with full multi-app scene for 5 minutes
- [ ] Monitor tick rate (should stay at 128 TPS)
- [ ] Verify no memory leaks (memory should stabilize)
- [ ] Test with 10 client connections simultaneously
- [ ] Verify snapshot delivery to all clients
- [ ] Test high-frequency entity spawning/despawning
- Blocks: WAVE 5

#### Code Quality Review
- [ ] All files under 200 lines
- [ ] No duplicate code patterns
- [ ] No hardcoded values (use config)
- [ ] Proper error handling at all boundaries
- [ ] No console.log() except for critical events
- [ ] Clear, self-documenting code (minimal comments needed)
- Blocks: WAVE 5

#### Developer Experience Review
- [ ] Can new developer create simple app in < 5 minutes?
- [ ] Are APIs discoverable through ctx object?
- [ ] Are error messages helpful?
- [ ] Can developer spawn/manage entities without reading source?
- [ ] Are patterns consistent across all apps?
- Blocks: WAVE 5

#### Documentation & Examples
- [ ] Verify CLAUDE.md is accurate and up-to-date
- [ ] Create example: simple moving platform (kinematic)
- [ ] Create example: destructible crate (dynamic + collision)
- [ ] Create example: NPC with waypoints (kinematic + update loop)
- [ ] Create example: spawning entities dynamically from player input
- [ ] Document the live app addition/removal patterns
- Blocks: WAVE 5

### WAVE 5: Final Integration & Ship

#### Cold Boot Test with Multi-App Scene
- [ ] Delete everything from src/ and apps/ except world definition
- [ ] Rebuild from scratch with TPS game as default
- [ ] Start server: should load environment, game, doors, NPCs, crates
- [ ] Connect client: should receive full entity list
- [ ] Verify all features work: physics, collisions, interactions, game logic
- [ ] Run for 10 minutes stable
- Blocks: Complete

#### Commit & Document
- [ ] All changes committed with clear messages
- [ ] Update CLAUDE.md with any new patterns discovered
- [ ] Verify git status is clean
- [ ] Ready for production deployment
- Blocks: Complete

---

## DEPENDENCIES & EXECUTION PLAN

**Sequential Wave Execution:**
1. **WAVE 1** - Multi-app testing (must understand current state first)
2. **WAVE 2** - Code optimization (improve before adding features)
3. **WAVE 2b** - Live management (depends on optimized code)
4. **WAVE 3** - TPS validation (depends on live management working)
5. **WAVE 4** - Quality & docs (depends on all features working)
6. **WAVE 5** - Final integration (depends on everything)

**Within each wave:** Run items in parallel where possible, sequentially where dependencies exist.
